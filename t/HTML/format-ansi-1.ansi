[37;1mpackage[0m[37m [0m[33;1;44mSyntax::Kamelon[0m[37m::[0m[33;1;44mWx[0m[37m::[0m[33;1;44mPluggableTextCtrl[0m[37m;[0m

[33;1;44muse[0m[37m [0m[37;1mstrict[0m[37m;[0m
[33;1;44muse[0m[37m [0m[37;1mwarnings[0m[37m;[0m
[33;1;44muse[0m[37m Carp;[0m

[33;1;44muse[0m[37m [0m[37;1mvars[0m[37m [0m[32mqw([0m[37m$VERSION[0m[32m)[0m[37m;[0m
[94m$VERSION[0m[37m=[0m[32m"[0m[31;103m0.01[0m[32m"[0m[37m;[0m

[33;1;44muse[0m[37m Wx [0m[32mqw([0m[37m :textctrl :font :colour [0m[32m)[0m[37m;[0m
[33;1;44muse[0m[37m [0m[33;1;44mWx::DND[0m[37m;[0m
[33;1;44muse[0m[37m Wx [0m[32mqw([0m[37m wxTheClipboard [0m[32m)[0m[37m;[0m
[33;1;44muse[0m[37m base [0m[32mqw([0m[37m Wx::TextCtrl [0m[32m)[0m[37m;[0m
[33;1;44muse[0m[37m [0m[33;1;44mWx::Event[0m[37m [0m[32mqw([0m[37m EVT_CHAR [0m[32m)[0m[37m;[0m

[33;1;44mrequire[0m[37m [0m[33;1;44mSyntax::Kamelon[0m[37m::[0m[33;1;44mWx[0m[37m::[0m[33;1;44mPluggableTextCtrl[0m[37m::[0m[33;1;44mKeyEchoes[0m[37m;[0m
[33;1;44mrequire[0m[37m [0m[33;1;44mSyntax::Kamelon[0m[37m::[0m[33;1;44mWx[0m[37m::[0m[33;1;44mPluggableTextCtrl[0m[37m::[0m[33;1;44mUndoRedo[0m[37m;[0m
[33;1;44mrequire[0m[37m [0m[33;1;44mSyntax::Kamelon[0m[37m::[0m[33;1;44mWx[0m[37m::[0m[33;1;44mPluggableTextCtrl[0m[37m::[0m[33;1;44mHighlighter[0m[37m;[0m

[37;1mmy[0m[37m [0m[94m$defaultfont[0m[37m = [[0m[94;1m10[0m[37m, wxFONTFAMILY_MODERN, wxFONTSTYLE_NORMAL, wxFONTWEIGHT_NORMAL, [0m[94;1m0[0m[37m];[0m

[37;1mmy[0m[37m [0m[94m$debug[0m[37m = [0m[94;1m0[0m[37m;[0m

[37;1mif[0m[37m ([0m[94m$debug[0m[37m) {[0m
[37m   [0m[33;1;44muse[0m[37m [0m[33;1;44mData::Dumper[0m[37m;[0m
[37m}[0m

[37;1msub [0m[33;1;44mnew[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$class[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[94m$class[0m[37m->[0m[94mSUPER[0m[37m::[0m[94mnew[0m[37m([0m[94m@_[0m[37m);[0m

[37m   [0m[94m$self[0m[37m->{CALLBACK} = [0m[37;1msub [0m[37m{};[0m
[37m   [0m[94m$self[0m[37m->{COMMANDS} = {[0m
[37m      [0m[32m'[0m[31mdoremove[0m[32m'[0m[37m => \&DoRemove,[0m
[37m      [0m[32m'[0m[31mdoreplace[0m[32m'[0m[37m => \&DoReplace,[0m
[37m      [0m[32m'[0m[31mdowrite[0m[32m'[0m[37m => \&DoWrite,[0m
[37m   };[0m
[37m   [0m[94m$self[0m[37m->{LISTENING} = [0m[94;1m0[0m[37m;[0m
[37m   [0m
[37m   [0m[94m$self[0m[37m->{OVRMODE} = [0m[94;1m0[0m[37m;[0m
[37m   [0m[94m$self[0m[37m->{PLUGINS} = [];[0m

[37m   [0m[94m$self[0m[37m->[0m[94mSetFont[0m[37m( [0m[33;1;44mWx::Font[0m[37m->new([0m[94m@$defaultfont[0m[37m) );[0m
[37m   EVT_CHAR([0m[94m$self[0m[37m, \&OnChar);[0m

[37m   [0m[37;1mreturn[0m[37m [0m[94m$self[0m[37m;[0m
[37m}[0m

[37;1msub [0m[33;1;44mAppendText[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1munless[0m[37m ([0m[94m$self[0m[37m->[0m[94mBroadcast[0m[37m([0m[32m'[0m[31mappend[0m[32m'[0m[37m, [0m[94m@_[0m[37m)) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSUPER[0m[37m::[0m[94mAppend[0m[37m([0m[94m@_[0m[37m);[0m
[37m   }[0m
[37m}[0m

[37;1msub [0m[33;1;44mBroadcast[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$plugs[0m[37m = [0m[94m$self[0m[37m->{PLUGINS};[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$flag[0m[37m = [0m[94;1m0[0m[37m;[0m
[37m   [0m[37;1mforeach[0m[37m ([0m[94m@$plugs[0m[37m) {[0m
[37m      [0m[37;1mif[0m[37m ([0m[34;43m$_[0m[37m->[0m[94mReceive[0m[37m([0m[94m@_[0m[37m)) {[0m
[37m         [0m[94m$flag[0m[37m = [0m[94;1m1[0m[37m;[0m
[37m      }[0m
[37m   }[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94m$flag[0m[37m;[0m
[37m}[0m

[37;1msub [0m[33;1;44mCall2Remove[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$self[0m[37m, [0m[94m$call[0m[37m, [0m[94m$index[0m[37m, [0m[94m$txt[0m[37m) = [0m[94m@_[0m[37m;[0m
[37m   [0m[37;1mif[0m[37m ([0m[94m$call[0m[37m =~ [0m[32m/[0m[33;1;42m.[0m[35m*[0m[33;1;42mremove[0m[35m$[0m[32m/[0m[37m) {[0m
[37m      [0m[37;1mreturn[0m[37m ([0m[94m$index[0m[37m, [0m[94m$index[0m[37m + [0m[33;1;44mlength[0m[37m([0m[94m$txt[0m[37m))[0m
[37m   } [0m[37;1melse[0m[37m {[0m
[37m      carp [0m[32m"[0m[31;103mCall '[0m[94m$call[0m[32m'[0m[31;103m is not a remove type[0m[32m"[0m[37m;[0m
[37m      [0m[37;1mreturn[0m[37m [0m[33;1;44mundef[0m
[37m   }[0m
[37m}[0m

[37;1msub [0m[33;1;44mCall2Replace[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$self[0m[37m, [0m[94m$call[0m[37m, [0m[94m$index[0m[37m, [0m[94m$old[0m[37m, [0m[94m$txt[0m[37m, [0m[94m$sel[0m[37m) = [0m[94m@_[0m[37m;[0m
[37m   [0m[37;1mif[0m[37m ([0m[94m$call[0m[37m =~ [0m[32m/[0m[33;1;42m.[0m[35m*[0m[33;1;42mreplace[0m[35m$[0m[32m/[0m[37m) {[0m
[37m      [0m[37;1mreturn[0m[37m ([0m[94m$index[0m[37m, [0m[94m$index[0m[37m + [0m[33;1;44mlength[0m[37m([0m[94m$old[0m[37m), [0m[94m$txt[0m[37m)[0m
[37m   } [0m[37;1melse[0m[37m {[0m
[37m      carp [0m[32m"[0m[31;103mCall '[0m[94m$call[0m[32m'[0m[31;103m is not a replace type[0m[32m"[0m[37m;[0m
[37m      [0m[37;1mreturn[0m[37m [0m[33;1;44mundef[0m
[37m   }[0m
[37m}[0m

[37;1msub [0m[33;1;44mCall2WriteText[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$self[0m[37m, [0m[94m$call[0m[37m, [0m[94m$index[0m[37m, [0m[94m$txt[0m[37m) = [0m[94m@_[0m[37m;[0m
[37m   [0m[37;1mif[0m[37m ([0m[94m$call[0m[37m =~ [0m[32m/[0m[33;1;42m.[0m[35m*[0m[33;1;42mwrite[0m[35m$[0m[32m/[0m[37m) {[0m
[37m      [0m[37;1mreturn[0m[37m [0m[94m$txt[0m
[37m   } [0m[37;1melse[0m[37m {[0m
[37m      carp [0m[32m"[0m[31;103mCall '[0m[94m$call[0m[32m'[0m[31;103m is not a write type[0m[32m"[0m[37m;[0m
[37m      [0m[37;1mreturn[0m[37m [0m[33;1;44mundef[0m
[37m   }[0m
[37m}[0m

[37;1msub [0m[33;1;44mCallback[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mif[0m[37m ([0m[94m@_[0m[37m) { [0m[94m$self[0m[37m->{CALLBACK} = [0m[33;1;44mshift[0m[37m; }[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94m$self[0m[37m->{CALLBACK};[0m
[37m}[0m

[37;1msub [0m[33;1;44mCanUndo[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94m$self[0m[37m->[0m[94mBroadcast[0m[37m([0m[32m'[0m[31mcanundo[0m[32m'[0m[37m);[0m
[37m}[0m

[37;1msub [0m[33;1;44mCanRedo[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94m$self[0m[37m->[0m[94mBroadcast[0m[37m([0m[32m'[0m[31mcanredo[0m[32m'[0m[37m);[0m
[37m}[0m

[37;1msub [0m[33;1;44mClear[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1munless[0m[37m ([0m[94m$self[0m[37m->[0m[94mBroadcast[0m[37m([0m[32m'[0m[31mclear[0m[32m'[0m[37m)) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSUPER[0m[37m::[0m[94mClear[0m[37m;[0m
[37m   }[0m
[37m}[0m

[37;1msub [0m[33;1;44mClearSelection[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$ins[0m[37m = [0m[94m$self[0m[37m->[0m[94mGetInsertionPoint[0m[37m;[0m
[37m   [0m[94m$self[0m[37m->[0m[94mSetSelection[0m[37m([0m[94m$ins[0m[37m, [0m[94m$ins[0m[37m);[0m
[37m}[0m

[37;1msub [0m[33;1;44mCommand[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$name[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mif[0m[37m ([0m[94m@_[0m[37m) { [0m[94m$self[0m[37m->{COMMANDS}[0m[32m-[0m[37m>{[0m[94m$name[0m[37m} = [0m[33;1;44mshift[0m[37m }[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94m$self[0m[37m->{COMMANDS}[0m[32m-[0m[37m>{[0m[94m$name[0m[37m}[0m
[37m}[0m

[37;1msub [0m[33;1;44mCopy[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1munless[0m[37m ([0m[94m$self[0m[37m->[0m[94mBroadcast[0m[37m([0m[32m'[0m[31mcopy[0m[32m'[0m[37m)) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSUPER[0m[37m::[0m[94mCopy[0m[37m;[0m
[37m   }[0m
[37m}[0m

[37;1msub [0m[33;1;44mCut[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1munless[0m[37m ([0m[94m$self[0m[37m->[0m[94mBroadcast[0m[37m([0m[32m'[0m[31mcut[0m[32m'[0m[37m)) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSUPER[0m[37m::[0m[94mCut[0m[37m;[0m
[37m   }[0m
[37m}[0m

[37;1msub [0m[33;1;44mDoRemove[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$index[0m[37m, [0m[94m$txt[0m[37m, [0m[94m$sel[0m[37m, [0m[94m$ins[0m[37m) = [0m[94m@_[0m[37m;[0m
[37m   [0m[94m$self[0m[37m->[0m[94mClearSelection[0m[37m;[0m
[37m   [0m[94m$self[0m[37m->[0m[94mSUPER[0m[37m::[0m[94mRemove[0m[37m([0m[94m$index[0m[37m, [0m[94m$index[0m[37m + [0m[33;1;44mlength[0m[37m([0m[94m$txt[0m[37m));[0m
[37m   [0m[37;1mif[0m[37m ([0m[33;1;44mdefined[0m[37m([0m[94m$ins[0m[37m)) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSetInsertionPoint[0m[37m([0m[94m$ins[0m[37m);[0m
[37m   }[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94;1m1[0m
[37m}[0m

[37;1msub [0m[33;1;44mDoReplace[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$self[0m[37m, [0m[94m$index[0m[37m, [0m[94m$old[0m[37m, [0m[94m$txt[0m[37m, [0m[94m$sel[0m[37m, [0m[94m$ins[0m[37m) = [0m[94m@_[0m[37m;[0m
[37m   [0m[94m$self[0m[37m->[0m[94mClearSelection[0m[37m;[0m
[37m   [0m[94m$self[0m[37m->[0m[94mSUPER[0m[37m::[0m[94mReplace[0m[37m([0m[94m$index[0m[37m, [0m[94m$index[0m[37m + [0m[33;1;44mlength[0m[37m([0m[94m$old[0m[37m), [0m[94m$txt[0m[37m);[0m
[37m   [0m[37;1mif[0m[37m ([0m[94m$sel[0m[37m) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSetSelection[0m[37m([0m[94m$index[0m[37m, [0m[94m$index[0m[37m + [0m[33;1;44mlength[0m[37m([0m[94m$txt[0m[37m));[0m
[37m   }[0m
[37m   [0m[37;1mif[0m[37m ([0m[33;1;44mdefined[0m[37m([0m[94m$ins[0m[37m)) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSetInsertionPoint[0m[37m([0m[94m$ins[0m[37m);[0m
[37m   }[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94;1m1[0m
[37m}[0m

[37;1msub [0m[33;1;44mDoWrite[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$self[0m[37m, [0m[94m$index[0m[37m, [0m[94m$txt[0m[37m, [0m[94m$sel[0m[37m, [0m[94m$ins[0m[37m) = [0m[94m@_[0m[37m;[0m
[37m   [0m[94m$self[0m[37m->[0m[94mClearSelection[0m[37m;[0m
[37m   [0m[94m$self[0m[37m->[0m[94mSetInsertionPoint[0m[37m([0m[94m$index[0m[37m);[0m
[37m   [0m[94m$self[0m[37m->[0m[94mSUPER[0m[37m::[0m[94mWriteText[0m[37m([0m[94m$txt[0m[37m);[0m
[37m   [0m[37;1mif[0m[37m ([0m[94m$sel[0m[37m) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSetSelection[0m[37m([0m[94m$index[0m[37m, [0m[94m$index[0m[37m + [0m[33;1;44mlength[0m[37m([0m[94m$txt[0m[37m));[0m
[37m   }[0m
[37m   [0m[37;1mif[0m[37m ([0m[33;1;44mdefined[0m[37m([0m[94m$ins[0m[37m)) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSetInsertionPoint[0m[37m([0m[94m$ins[0m[37m);[0m
[37m   }[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94;1m1[0m
[37m}[0m

[37;1msub [0m[33;1;44mFindPluginId[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$self[0m[37m, [0m[94m$name[0m[37m) = [0m[94m@_[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$plgs[0m[37m = [0m[94m$self[0m[37m->{PLUGINS};[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$index[0m[37m = [0m[94;1m0[0m[37m;[0m
[37m   [0m[37;1mforeach[0m[37m ([0m[94m@$plgs[0m[37m) {[0m
[37m      [0m[37;1mif[0m[37m ([0m[94m$name[0m[37m [0m[32meq[0m[37m [0m[94m$plgs[0m[37m->[[0m[94m$index[0m[37m][0m[32m-[0m[37m>Name) {[0m
[37m         [0m[37;1mreturn[0m[37m [0m[94m$index[0m
[37m      }[0m
[37m      [0m[94m$index[0m[37m ++;[0m
[37m   }[0m
[37;1;44m#   carp "Plugin $name is not loaded\n";[0m
[37m   [0m[37;1mreturn[0m[37m [0m[33;1;44mundef[0m[37m;[0m
[37m}[0m

[37;1msub [0m[33;1;44mFindPlugin[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$self[0m[37m, [0m[94m$name[0m[37m) = [0m[94m@_[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$plgs[0m[37m = [0m[94m$self[0m[37m->{PLUGINS};[0m
[37m   [0m[37;1mforeach[0m[37m ([0m[94m@$plgs[0m[37m) {[0m
[37m      [0m[37;1mif[0m[37m ([0m[94m$name[0m[37m [0m[32meq[0m[37m [0m[34;43m$_[0m[37m->[0m[94mName[0m[37m) {[0m
[37m			[0m[37;1mreturn[0m[37m [0m[34;43m$_[0m
[37m      }[0m
[37m   }[0m
[37m   [0m[37;1mreturn[0m[37m [0m[33;1;44mundef[0m[37m;[0m
[37m}[0m

[37;1msub [0m[33;1;44mGetClipboardText[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$txt[0m[37m = [0m[33;1;44mundef[0m[37m;[0m
[37m   [0m[37;1mif[0m[37m (wxTheClipboard->Open) {[0m
[37m      [0m[37;1mif[0m[37m ([0m[94m$debug[0m[37m) { [0m[33;1;44mprint[0m[37m [0m[32m"[0m[31;103mClipboard open[0m[35m\n[0m[32m"[0m[37m }[0m
[37m      [0m[37;1mmy[0m[37m [0m[94m$textdata[0m[37m = [0m[33;1;44mWx::TextDataObject[0m[37m->new;[0m
[37m      [0m[37;1mmy[0m[37m [0m[94m$ok[0m[37m = wxTheClipboard->GetData( [0m[94m$textdata[0m[37m );[0m
[37m      [0m[37;1mif[0m[37m( [0m[94m$ok[0m[37m ) {[0m
[37m         [0m[94m$txt[0m[37m = [0m[94m$textdata[0m[37m->[0m[94mGetText[0m[37m;[0m
[37m      }[0m
[37m      [0m[37;1mif[0m[37m ([0m[94m$debug[0m[37m [0m[32mand[0m[37m [0m[33;1;44mdefined[0m[37m([0m[94m$txt[0m[37m)) { [0m[33;1;44mprint[0m[37m [0m[32m"[0m[31;103mClipboard text: [0m[94m$txt[0m[35m\n[0m[32m"[0m[37m }[0m
[37m      wxTheClipboard->Close;[0m
[37m   }[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94m$txt[0m[37m;[0m
[37m}[0m

[37;1msub [0m[33;1;44mGetLineNumber[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$self[0m[37m, [0m[94m$index[0m[37m) = [0m[94m@_[0m[37m;[0m
[37m   [0m[37;1munless[0m[37m ([0m[33;1;44mdefined[0m[37m([0m[94m$index[0m[37m)) { [0m[94m$index[0m[37m = [0m[94m$self[0m[37m->[0m[94mGetInsertionPoint[0m[37m };[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$col[0m[37m, [0m[94m$line[0m[37m) = [0m[94m$self[0m[37m->[0m[94mPositionToXY[0m[37m([0m[94m$index[0m[37m);[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94m$line[0m[37m;[0m
[37m}[0m

[37;1msub [0m[33;1;44mHasSelection[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$selb[0m[37m, [0m[94m$sele[0m[37m) = [0m[94m$self[0m[37m->[0m[94mGetSelection[0m[37m;[0m
[37m   [0m[37;1mreturn[0m[37m ([0m[94m$selb[0m[37m [0m[32mne[0m[37m [0m[94m$sele[0m[37m)[0m
[37m}[0m

[37;1;44m# [0m[37;1;42mTODO[0m[37;1;44m make this unicode compatible[0m
[37;1msub [0m[33;1;44mIsWriteable[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$self[0m[37m, [0m[94m$key[0m[37m) = [0m[94m@_[0m[37m;[0m
[37m   [0m[37;1mif[0m[37m ((([0m[94m$key[0m[37m >= [0m[94;1m32[0m[37m) [0m[32mand[0m[37m ([0m[94m$key[0m[37m < [0m[94;1m127[0m[37m)) [0m[32mor[0m[37m (([0m[94m$key[0m[37m > [0m[94;1m127[0m[37m) [0m[32mand[0m[37m ([0m[94m$key[0m[37m < [0m[94;1m256[0m[37m))) {[0m
[37m      [0m[37;1mreturn[0m[37m [0m[94;1m1[0m
[37m   }[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94;1m0[0m
[37m}[0m

[37;1msub [0m[33;1;44mListening[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mif[0m[37m ([0m[94m@_[0m[37m) {[0m
[37m      [0m[37;1mmy[0m[37m [0m[94m$new[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m      [0m[37;1munless[0m[37m ([0m[94m$new[0m[37m [0m[32meq[0m[37m [0m[94m$self[0m[37m->{LISTENING}) {[0m
[37m         [0m[37;1mmy[0m[37m [0m[94m$plgs[0m[37m = [0m[94m$self[0m[37m->{PLUGINS};[0m
[37m         [0m[37;1mif[0m[37m ([0m[94m$new[0m[37m) {[0m
[37m            [0m[33;1;44munshift[0m[37m [0m[94m@$plgs[0m[37m, [0m[94m$self[0m
[37m         } [0m[37;1melse[0m[37m {[0m
[37m            [0m[33;1;44mshift[0m[37m [0m[94m@$plgs[0m
[37m         }[0m
[37m         [0m[94m$self[0m[37m->{LISTENING} = [0m[94m$new[0m
[37m      }[0m
[37m   }[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94m$self[0m[37m->{LISTENING}[0m
[37m}[0m

[37;1msub [0m[33;1;44mLoadFile[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1munless[0m[37m ([0m[94m$self[0m[37m->[0m[94mBroadcast[0m[37m([0m[32m'[0m[31mload[0m[32m'[0m[37m, [0m[94m@_[0m[37m)) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSUPER[0m[37m::[0m[94mLoadFile[0m[37m([0m[94m@_[0m[37m);[0m
[37m   }[0m
[37m}[0m

[37;1msub [0m[33;1;44mLoadPlugin[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m	[0m[37;1mmy[0m[37m [0m[94m$plug[0m[37m = [0m[33;1;44mundef[0m[37m;[0m
[37m	[0m[37;1mmy[0m[37m [0m[94m$name[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m	[0m[37;1;44m#Does anybody have a better idea for this?[0m
[37m	[0m[94m$name[0m[37m = [0m[32m"[0m[31;103mSyntax::Kamelon::Wx::PluggableTextCtrl::[0m[94m$name[0m[32m"[0m[37m;[0m
[37m	[0m[94m$plug[0m[37m = [0m[94m$name[0m[37m->[0m[94mnew[0m[37m([0m[94m$self[0m[37m, [0m[94m@_[0m[37m);[0m
[37m	[0m[37;1mif[0m[37m ([0m[33;1;44mdefined[0m[37m([0m[94m$plug[0m[37m)) {[0m
[37m		[0m[94m$self[0m[37m->[0m[94mRegisterPlugin[0m[37m([0m[94m$plug[0m[37m);[0m
[37m	} [0m[37;1melse[0m[37m {[0m
[37m		carp [0m[32m"[0m[31;103munable to load plugin [0m[94m$name[0m[35m\n[0m[32m"[0m[37m;[0m
[37m	}[0m
[37m}[0m

[37;1msub [0m[33;1;44mName[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$name[0m[37m = [0m[33;1;44mref[0m[37m [0m[94m$self[0m[37m;[0m
[37m   [0m[94m$name[0m[37m =~[0m[32ms/[0m[33;1;42m.[0m[35m*[0m[33;1;42m::[0m[32m//[0m[37m;[0m
[37m   [0m[37;1mif[0m[37m ([0m[94m$debug[0m[37m) { [0m[33;1;44mprint[0m[37m [0m[32m"[0m[31;103mplugin name is [0m[94m$name[0m[35m\n[0m[32m"[0m[37m }[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94m$name[0m
[37m}[0m

[37;1msub [0m[33;1;44mOnChar[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$self[0m[37m, [0m[94m$event[0m[37m) = [0m[94m@_[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$k[0m[37m = [0m[94m$event[0m[37m->[0m[94mGetKeyCode[0m[37m;[0m
[37m   [0m[37;1mif[0m[37m ([0m[94m$k[0m[37m [0m[32meq[0m[37m [0m[94;1m322[0m[37m) { [0m[37;1;44m#Insert key pressed, record flip insert/ovr mode.[0m
[37m      [0m[37;1mif[0m[37m ([0m[94m$self[0m[37m->[0m[94mOvrMode[0m[37m) {[0m
[37m         [0m[94m$self[0m[37m->[0m[94mOvrMode[0m[37m([0m[94;1m0[0m[37m)[0m
[37m      } [0m[37;1melse[0m[37m {[0m
[37m         [0m[94m$self[0m[37m->[0m[94mOvrMode[0m[37m([0m[94;1m1[0m[37m)[0m
[37m      }[0m
[37m   }[0m
[37m   [0m[37;1munless[0m[37m ([0m[94m$self[0m[37m->[0m[94mBroadcast[0m[37m([0m[32m'[0m[31mkey[0m[32m'[0m[37m, [0m[94m$event[0m[37m)) {[0m
[37m      [0m[94m$event[0m[37m->[0m[94mSkip[0m[37m;[0m
[37m   }[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$callback[0m[37m = [0m[94m$self[0m[37m->[0m[94mCallback[0m[37m;[0m
[37m   &[0m[94m$callback[0m[37m;[0m
[37m}[0m

[37;1msub [0m[33;1;44mOvrMode[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mif[0m[37m ([0m[94m@_[0m[37m) { [0m[94m$self[0m[37m->{OVRMODE} = [0m[33;1;44mshift[0m[37m; }[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94m$self[0m[37m->{OVRMODE};[0m
[37m}[0m

[37;1msub [0m[33;1;44mPaste[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1munless[0m[37m ([0m[94m$self[0m[37m->[0m[94mBroadcast[0m[37m([0m[32m'[0m[31mpaste[0m[32m'[0m[37m)) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSUPER[0m[37m::[0m[94mPaste[0m[37m;[0m
[37m   }[0m
[37m}[0m

[37;1msub [0m[33;1;44mPlugin[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$id[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$plgs[0m[37m = [0m[94m$self[0m[37m->{PLUGINS};[0m
[37m   [0m[37;1munless[0m[37m ([0m[94m$id[0m[37m =~ [0m[32m/[0m[35m^[0m[32m\d[0m[35m+$[0m[32m/[0m[37m) {[0m
[37m      [0m[94m$id[0m[37m = [0m[94m$self[0m[37m->[0m[94mFindPluginId[0m[37m([0m[94m$id[0m[37m);[0m
[37m   }[0m
[37m   [0m[37;1mif[0m[37m ([0m[94m@_[0m[37m) { [0m
[37m      [0m[94m$self[0m[37m->{PLUGINS}[0m[32m-[0m[37m>[[0m[94m$id[0m[37m] = [0m[33;1;44mshift[0m[37m; [0m
[37m   }[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94m$self[0m[37m->{PLUGINS}[0m[32m-[0m[37m>[[0m[94m$id[0m[37m];[0m
[37m}[0m

[37;1msub [0m[33;1;44mReceive[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$name[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37;1;44m#    if ($debug) { print "received $name\n"; print Dumper $self->{COMMANDS} }[0m
[37m   [0m[37;1mif[0m[37m ([0m[33;1;44mexists[0m[37m [0m[94m$self[0m[37m->{COMMANDS}[0m[32m-[0m[37m>{[0m[94m$name[0m[37m}) {[0m
[37m      [0m[37;1mif[0m[37m ([0m[94m$debug[0m[37m) { [0m[33;1;44mprint[0m[37m [0m[32m"[0m[31;103mexecuting [0m[94m$name[0m[35m\n[0m[32m"[0m[37m }[0m
[37m      [0m[37;1mmy[0m[37m [0m[94m$cmd[0m[37m = [0m[94m$self[0m[37m->[0m[94mCommand[0m[37m([0m[94m$name[0m[37m);[0m
[37m      [0m[37;1mreturn[0m[37m &[0m[94m$cmd[0m[37m([0m[94m$self[0m[37m, [0m[94m@_[0m[37m);[0m
[37m   }[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94;1m0[0m
[37m}[0m

[37;1msub [0m[33;1;44mRedo[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1munless[0m[37m ([0m[94m$self[0m[37m->[0m[94mBroadcast[0m[37m([0m[32m'[0m[31mredo[0m[32m'[0m[37m)) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSUPER[0m[37m::[0m[94mRedo[0m[37m;[0m
[37m   }[0m
[37m}[0m

[37;1msub [0m[33;1;44mRegisterPlugin[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$self[0m[37m, [0m[94m$plug[0m[37m) = [0m[94m@_[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$pl[0m[37m = [0m[94m$self[0m[37m->{PLUGINS};[0m
[37m   [0m[33;1;44mpush[0m[37m [0m[94m@$pl[0m[37m, [0m[94m$plug[0m[37m;[0m
[37m}[0m

[37;1msub [0m[33;1;44mRemove[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m@call[0m[37m = [0m[94m$self[0m[37m->[0m[94mRemove2Call[0m[37m([0m[94m@_[0m[37m);[0m
[37m   [0m[37;1munless[0m[37m ([0m[94m$self[0m[37m->[0m[94mBroadcast[0m[37m([0m[94m@call[0m[37m)) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSUPER[0m[37m::[0m[94mRemove[0m[37m([0m[94m@_[0m[37m);[0m
[37m   }[0m
[37m}[0m

[37;1msub [0m[33;1;44mRemove2Call[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$self[0m[37m, [0m[94m$begin[0m[37m, [0m[94m$end[0m[37m) = [0m[94m@_[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$sel[0m[37m = [0m[94;1m0[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$selb[0m[37m, [0m[94m$sele[0m[37m) = [0m[94m$self[0m[37m->[0m[94mGetSelection[0m[37m;[0m
[37m   [0m[37;1mif[0m[37m (([0m[94m$selb[0m[37m [0m[32meq[0m[37m [0m[94m$begin[0m[37m) [0m[32mand[0m[37m ([0m[94m$sele[0m[37m [0m[32meq[0m[37m [0m[94m$end[0m[37m)) { [0m[94m$sel[0m[37m = [0m[94;1m1[0m[37m }[0m
[37m   [0m[37;1mreturn[0m[37m ([0m[32m'[0m[31mremove[0m[32m'[0m[37m, [0m[94m$begin[0m[37m, [0m[94m$self[0m[37m->[0m[94mGetRange[0m[37m([0m[94m$begin[0m[37m, [0m[94m$end[0m[37m), [0m[94m$sel[0m[37m)[0m
[37m}[0m

[37;1msub [0m[33;1;44mReplace[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m@call[0m[37m = [0m[94m$self[0m[37m->[0m[94mReplace2Call[0m[37m([0m[94m@_[0m[37m);[0m
[37m   [0m[37;1munless[0m[37m ([0m[94m$self[0m[37m->[0m[94mBroadcast[0m[37m([0m[94m@call[0m[37m)) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSUPER[0m[37m::[0m[94mReplace[0m[37m([0m[94m@_[0m[37m);[0m
[37m   }[0m
[37m}[0m

[37;1msub [0m[33;1;44mReplace2Call[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$self[0m[37m, [0m[94m$begin[0m[37m, [0m[94m$end[0m[37m, [0m[94m$txt[0m[37m) = [0m[94m@_[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$sel[0m[37m = [0m[94;1m0[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$selb[0m[37m, [0m[94m$sele[0m[37m) = [0m[94m$self[0m[37m->[0m[94mGetSelection[0m[37m;[0m
[37m   [0m[37;1mif[0m[37m (([0m[94m$selb[0m[37m [0m[32meq[0m[37m [0m[94m$begin[0m[37m) [0m[32mand[0m[37m ([0m[94m$sele[0m[37m [0m[32meq[0m[37m [0m[94m$end[0m[37m)) { [0m[94m$sel[0m[37m = [0m[94;1m1[0m[37m }[0m
[37m   [0m[37;1mreturn[0m[37m ([0m[32m'[0m[31mreplace[0m[32m'[0m[37m, [0m[94m$begin[0m[37m, [0m[94m$txt[0m[37m, [0m[94m$self[0m[37m->[0m[94mGetRange[0m[37m([0m[94m$begin[0m[37m, [0m[94m$end[0m[37m), [0m[94m$sel[0m[37m)[0m
[37m}[0m

[37;1msub [0m[33;1;44mSaveFile[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1munless[0m[37m ([0m[94m$self[0m[37m->[0m[94mBroadcast[0m[37m([0m[32m'[0m[31msave[0m[32m'[0m[37m, [0m[94m@_[0m[37m)) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSUPER[0m[37m::[0m[94mSaveFile[0m[37m([0m[94m@_[0m[37m);[0m
[37m   }[0m
[37m}[0m

[37;1msub [0m[33;1;44mNativePlugins[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mreturn[0m[37m [0m[32mqw[[0m[37m Highlighter KeyEchoes UndoRedo   [0m[32m][0m
[37m}[0m

[37;1msub [0m[33;1;44mSyntax[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mreturn[0m[37m [0m[94m$self[0m[37m->[0m[94mBroadcast[0m[37m([0m[32m'[0m[31msyntax[0m[32m'[0m[37m, [0m[94m@_[0m[37m);[0m
[37m}[0m

[37;1msub [0m[33;1;44mUndo[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1munless[0m[37m ([0m[94m$self[0m[37m->[0m[94mBroadcast[0m[37m([0m[32m'[0m[31mundo[0m[32m'[0m[37m)) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSUPER[0m[37m::[0m[94mUndo[0m[37m;[0m
[37m   }[0m
[37m}[0m

[37;1msub [0m[33;1;44mWriteText[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m$self[0m[37m = [0m[33;1;44mshift[0m[37m;[0m
[37m   [0m[37;1mmy[0m[37m [0m[94m@call[0m[37m = [0m[94m$self[0m[37m->[0m[94mWriteText2Call[0m[37m([0m[94m@_[0m[37m);[0m
[37m   [0m[37;1munless[0m[37m ([0m[94m$self[0m[37m->[0m[94mBroadcast[0m[37m([0m[94m@call[0m[37m)) {[0m
[37m      [0m[94m$self[0m[37m->[0m[94mSUPER[0m[37m::[0m[94mWriteText[0m[37m([0m[94m@_[0m[37m);[0m
[37m   }[0m
[37m}[0m

[37;1msub [0m[33;1;44mWriteText2Call[0m[37m {[0m
[37m   [0m[37;1mmy[0m[37m ([0m[94m$self[0m[37m, [0m[94m$txt[0m[37m) = [0m[94m@_[0m[37m;[0m
[37m   [0m[37;1mreturn[0m[37m ([0m[32m'[0m[31mwrite[0m[32m'[0m[37m, [0m[94m$self[0m[37m->[0m[94mGetInsertionPoint[0m[37m, [0m[94m$txt[0m[37m, [0m[94;1m0[0m[37m);[0m
[37m}[0m


[94;1m1[0m[37m;[0m
[37;1m__END__[0m
